---
title: "Handout 02- Visualising Data"
date: "Semester 1, 2022"
output:
  html_document:
    toc: true
    toc_float: true
    toc_depth: 3
    code_download: true
    code_folding: show
---

```{r setup, include=FALSE}
library(knitr)

knitr::opts_chunk$set(
  comment = "#>",
  fig.path = "figures/", # use only for single Rmd files
  collapse = TRUE,
  echo = TRUE
)
```



> #### Data Focus
>
> Modules and Handouts 2--6 cover topics that are part of the data analysis journey and are all interrelated to one another. The way that it has been separated is to introduce main topic but then each subsequent topic will add in additional content for previous topics. E.g. we start with data visualisation to introduce the basics of the plotting systems but then each other handout will include extra options and customisations.
 
\

\
 
 
Handout: [Handout 02 - Visualising Data](handout2.html)

Associated Readings:

- [R for Data Science - Chapter 12](https://r4ds.had.co.nz/tidy-data.html)
- [R for Data Science - Chapter 11](https://r4ds.had.co.nz/data-import.html)
- [R for Data Science - Chapter 3](https://r4ds.had.co.nz/data-visualisation.html)


 
## Tidy data principles

Before we delve we bring data into R and start to visualise it. We first need to learn about how computers like data to be structured.

It's very common to collect data using a spreadsheet, so here are some principles for setting up your spreadsheet:

1. Make it rectangular
2. Columns are variables
3. Rows are observations
4. One piece of information per cell

Think about how you are dealing with missing data.

In general we would recommend saving your data in the "comma separated values" (csv) format. This is a format where all your data is in plain text (you can view it in a text editor) and it is highly portable between different languages/programs.


### Downloading data

In order to obtain the example data used in the rest of the handout you can download and save it using:

```{r, eval=FALSE}
download.file(url = "https://raw.githubusercontent.com/rtis-training/2022-s1-r4ssp/main/data/r4ssp_donations_data.csv", 
              destfile = "data/r4ssp_donations_data.csv")
```

Please note this assumes you are using the project and structure created in the last handout. Importantly if this doesn't work for you check that the "data" folder exists and matches exactly.

\

## Read data in from csv

There are two main approaches to reading data into R.

- Data imported (point and click)
- Code

Both methods provide either a Base R option or a Tidyverse (`readr`) option.


**Data Importer**

The first approach is a point-and-click method, using the data importer found in the environment panel. This can be useful to get a preview of how your data is going to be read in. Once you have imported your data, make sure to keep the code that was generated and can subsequently be used as the second approach


**Code**

Using code there are two main functions that are used for reading in csv data. `read.csv` from Base R and `read_csv` from `readr` (as part of the Tidyverse). They have minor differences in how they operate, the main difference being that prior to R v4, `read.csv` would by default load character type data in as _Factors_.

> ### Tidyverse and Base R
> 
> So far the syntax and methods you have been introduced to have been entirely part of what is known as "Base R" i.e. it's all available right out of the box. There's an ecosystem of extremely popular additional packages created by most prominently by Hadley Wickham (and others) that follow a similar (opinionated) design principle that is primarily focused on (tidy) data analysis - the Tidyverse. The Tidyverse is a collection of packages that we will make heavy use of during this course but such as `readr` for reading data, `ggplot2` for plotting, and `dplyr` and `tidyr` for data manipulations.
>
> the `tidyverse` "metapackage" provides a convenient way to both install and load the core packages that form the tidyverse, but you may choose to load only the exact packages you wish to use.
> 
> ```{r eval = FALSE}
> # only needs to be done once
> install.packages("tidyverse")
> ```
>
> ```{r}
> # do each time you start an R session
> library(tidyverse)
> ```
>
> We believe that it's important to show you how to use both Base R and the Tidyverse because together they will give you a very powerful set of tools to tackle your data analysis and understand other code you come across.


----
  
### Base R

```{r, eval=FALSE}
# common options for running read.csv
my_data <- read.csv(file = "myfile.csv", header = TRUE , stringsAsFactors = FALSE)
```

> `stringsAsFactors=FALSE`
>
> Factors are a datatype that is used within R for coding categorical data. For R versions < 4, the default for `read.csv` was to bring in character data as a Factor (i.e. `stringsAsFactors=TRUE`), to prevent this and have the data be read in as character type it is common to see the argument `stringsAsFactors=FALSE`. From R v4 and up, the _default option was changed_ to be `stringsAsFactors=FALSE`.

----

### Tidyverse

The package from the tidyverse the deals with reading in data is `readr`. If you have already run `library(tidyverse)` it will automatically have been loaded for you. If you aren't making use of the other Tidyverse packages if can be a good idea load only `readr`: `library(readr)`.

```{r, eval=FALSE}
# common options for running read_csv
my_data <- read_csv(file = "my_file.csv", col_names = TRUE)
```

`read_csv` will display an output describing the data load process. This output can be an extremely useful first check if you data has loaded in how you wanted it to and is worth checking that columns are of the correct data type.


----

\

## Previewing data

First we'll load in the example dataset that is going to be used, we'll use `read_csv` from `readr` to do this.

```{r}
# Read a csv file into R. Store the result in a named variable
puppy_donations_data <- read_csv("data/r4ssp_donations_data.csv")
```


Once your data is loaded, it's worth checking to make sure that everything is as you expect, as this is usually the largest source of errors once you get to analysis.


### Viewing

These functions give different ways of viewing your data

- `View`
- `head`
- `tail`

### Checking


These functions provide ways of checking the size and type of data that has been read in.

Size:

- `dim`
- `nrow`
- `ncol`

Type:

- `class`
- `names`
- `str`

The largest source (anecdotal) of analysis errors is either numeric data coming in as characters - which could be caused by something unseen like a 'blank cell' in Excel that actually contained a space.

Sanity:

It can also be a good idea to do a 'sanity' check on your data which can give a very quick summary of each of the columns to give you an idea if the data was read in properly, and give you an idea about the distributions and possible issues you might encounter.

This can be done with `summary`

```{r}
summary(puppy_donations_data)
```


\

\

## Data visualisation 

There are two main methods for plotting data in R. The first is the in-built plotting functions within base R. The second is using a popular package called `ggplot2`.

Here we'll introduce you to both systems to create some simple plots. In future modules we'll cover more about plotting.




### Base R 

#### Scatter plots

Scatter plots are a straight forward way to get a look at our data



```{r handout2_scatter}
plot(puppy_donations_data$CollectorNumber, puppy_donations_data$Amount)
```

And once more with colour!

```{r handout2_red_scatter}
plot(puppy_donations_data$CollectorNumber, puppy_donations_data$Amount, col = "red")
```


#### Line plots


```{r handout2_lineplot}
plot(puppy_donations_data$CollectorNumber, puppy_donations_data$Amount, type = 'l')
```

You can also include the exact data points too

```{r handout2_lineplot2}
plot(puppy_donations_data$CollectorNumber, puppy_donations_data$Amount, type = 'b')
```

#### Histograms


```{r handout2_hist}
hist(puppy_donations_data$Amount)
```

### Boxplots

Remember that this data has a condition under which the data was collected - with and without a puppy. Boxplots provide a way to get an understanding of our data using categorical information.

The R function `boxplot` accepts two arguments. 

The first argument is the **formula**. This is a complex, yet very common, argument format for R statistical functions. The formula describes a linear model for a data set with the general structure: **dependent or predicted variable ~ independent variables or predictors**, using columns names from the data frame. The ~ (tilde) is read as "depends on" or "is predicted by". For our example, we are interested in the way that Amount is dependent on the Puppy/Alone condition, so we specify our formula as **Amount ~ Condition**.  We will see more complex examples of the formula argument later in the semester.


The second argument to boxplot is the data frame.

```{r handout2_boxplot01}
boxplot(Amount ~ Condition, puppy_donations_data)
```

\

\

### Tidyverse - ggplot2

The ggplot2 package is a popular data visualisation package for R. It was developed by Hadley Wickham to implement the 'grammar of graphics'. In order to use it we need to first load it into R.

```{r}
library(ggplot2)
```

ggplot tackles plotting reducing it into three components

- what is the data
- how the data is mapped to aesthetics (aes)
- how the data is represented geometrically (geom)

So to create a plot using ggplot we need to specify these three components.


Plots can then be made incrementally by adding on additional layers.

We'll now recreate the same plots as we did with the Base R plotting system.

#### Scatter plots

Here you'll see we've defined our data, we've mapped specific columns to our axes, and are using a 'point' as our geometric representation.

```{r handout2_gg_point1}
ggplot(data = puppy_donations_data, mapping = aes(x = CollectorNumber, y = Amount)) + 
  geom_point()
```

We can also store our plots in a variable to build upon

```{r}
p <- ggplot(data = puppy_donations_data, mapping = aes(x = CollectorNumber, y = Amount))
```

What does `p` actually contain?
```{r handout2_gg}
p
```


```{r handout2_gg_point2}
p + geom_point()
```


##### Specifiying colour

Remember `p` contains our initial specification of the data and mappings

```{r handout2_gg_point3}
p + geom_point(colour = 'red')
```

##### Mapping colour from our data

```{r handout2_gg_point4}
p + geom_point(aes(colour = Condition))
```
Notice that we didn't specify the colour for our points, instead we have told ggplot to use colours based on the values that were found in the "Condition" column using `aes`.

\

#### Line plots

In this case, we have the same data and mapping, but we want to have the data represented by a line so we choose `geom_line` as our "geom".

```{r handout2_gg_line1}
p + geom_line()
```




##### Adding layers

```{r handout2_gg_line2}
p + 
  geom_line() + 
  geom_point()
```



```{r handout2_gg_line3}
p + 
  geom_line(colour = 'gold') + 
  geom_point(colour = 'tomato')
```

##### Using mappings

If you would like to plot individual lines based on a categorical variable you can used a 'group' mapping:

```{r handout2_gg_line4}
p + 
  geom_line(aes(group = Condition))
```


We can specify separate aesthestics for each layer

```{r handout2_gg_line5}
p + 
  geom_line(aes(colour = Condition)) + 
  geom_point(aes(colour = Condition))
```

Note that colour will automatically imply a _group_.

or if it is common to all layers, we can specify them in the initial setting up:

```{r handout2_gg_line6}
ggplot(data = puppy_donations_data, 
       mapping = aes(x = CollectorNumber, 
                     y = Amount, 
                     colour = Condition)) + 
  geom_line() + 
  geom_point()
```

\

#### Histogram

A histogram is created from a single continuous variable.

```{r handout2_gg_hist}
ggplot(data = puppy_donations_data, aes(x = Amount)) + 
  geom_histogram()
```

\

#### Boxplot

In ggplot, to create a boxplot, we need to specify a continuous variable, and a categorical variable.

```{r handout2_gg_box1}
ggplot(data = puppy_donations_data, aes(x = Condition, y = Amount)) + 
  geom_boxplot()
```

Or you could make it horizontal by switching the the x/y arguments.

```{r handout2_gg_box2}
ggplot(data = puppy_donations_data, aes(x = Amount, y = Condition)) + 
  geom_boxplot()
```

\

### Customising

There are a multitude of customisations that can be done to plots such as titles, labels, colours, etc.

A fantastic resource for looking at how to customise your plots made using the Base R plotting system is the [R Graphics Cookbook](https://r-graphics.org).

#### Themes

For ggplot, the plots are made up of _elements_ and can be customised using `theme()` or by picking one of the pre-defined themes - e.g. `theme_bw()` provides a black/white theme.

The main elements are

- `element_text` for text
- `element_rect` for rectangular areas
- `element_line` for lines
- `element_blank` to remove/hide elements

```{r handout2_gg_theme1}
ggplot(data = puppy_donations_data, aes(x = Condition, y = Amount)) + 
  geom_boxplot() + 
  theme(axis.title = element_text(size = 16), 
        panel.grid = element_blank(), 
        panel.background = element_rect(colour = "blue", fill = "light green"))

```



```{r handout2_gg_theme2}
ggplot(data = puppy_donations_data, aes(x = Condition, y = Amount)) + 
  geom_boxplot() + 
  theme_bw()
```



There is also a fantastic cheat sheet available in RStudio under `Help` -> `Cheat Sheats` -> `Data Visualization with ggplot2`

\

\

## Excercises


1. Using the Base R scatter plot of the puppies data, customise the label, title, and colour. `help("plot")` may offer some assistance.

2. Modify the Base R histogram to be a different colour.

3. Using the ggplot scatter plot: customise the label, title, and colour

4. Using a ggplot of your choice, choose a predefined theme and then modify it
